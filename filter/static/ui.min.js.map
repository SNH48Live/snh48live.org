{"version":3,"sources":["ui.jsx"],"names":[],"mappings":"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","file":"ui.min.js","sourcesContent":["/* globals Infinite, React, ReactDOM, URI, fetch */\n\n(function () {\n  // Root of the app, defined in a script tag in HTML\n  const APPROOT = window.APPROOT || '';\n\n  const keyValuePairsToMap = arr => Object.assign(...arr.map(([k, v]) => ({[k]: v})));\n\n  const MEMBER_AFFILIATIONS = [\n    ['陈观慧', 's2'],\n    ['陈思', 's2'],\n    ['成珏', 's2'],\n    ['戴萌', 's2'],\n    ['蒋芸', 's2'],\n    ['孔肖吟', 's2'],\n    ['李宇琪', 's2'],\n    ['吕一', 's2'],\n    ['莫寒', 's2'],\n    ['潘燕琦', 's2'],\n    ['钱蓓婷', 's2'],\n    ['邱欣怡', 's2'],\n    ['沈之琳', 's2'],\n    ['孙芮', 's2'],\n    ['温晶婕', 's2'],\n    ['吴哲晗', 's2'],\n    ['徐晨辰', 's2'],\n    ['徐子轩', 's2'],\n    ['许佳琪', 's2'],\n    ['袁丹妮', 's2'],\n    ['袁雨桢', 's2'],\n    ['张语格', 's2'],\n    ['赵晔', 's2'],\n\n    ['陈佳莹', 'n2'],\n    ['陈问言', 'n2'],\n    ['冯薪朵', 'n2'],\n    ['葛佳慧', 'n2'],\n    ['龚诗淇', 'n2'],\n    ['何晓玉', 'n2'],\n    ['黄婷婷', 'n2'],\n    ['黄彤扬', 'n2'],\n    ['江真仪', 'n2'],\n    ['金莹玥', 'n2'],\n    ['鞠婧祎', 'n2'],\n    ['李艺彤', 'n2'],\n    ['林思意', 'n2'],\n    ['刘菊子', 'n2'],\n    ['刘瀛', 'n2'],\n    ['陆婷', 'n2'],\n    ['万丽娜', 'n2'],\n    ['许逸', 'n2'],\n    ['易嘉爱', 'n2'],\n    ['曾艳芬', 'n2'],\n    ['张雨鑫', 'n2'],\n    ['赵粤', 'n2'],\n    ['周怡', 'n2'],\n\n    ['郭倩芸', 'h2'],\n    ['郝婉晴', 'h2'],\n    ['姜涵', 'h2'],\n    ['李清扬', 'h2'],\n    ['林楠', 'h2'],\n    ['刘炅然', 'h2'],\n    ['刘佩鑫', 'h2'],\n    ['沈梦瑶', 'h2'],\n    ['孙珍妮', 'h2'],\n    ['王柏硕', 'h2'],\n    ['王金铭', 'h2'],\n    ['王露皎', 'h2'],\n    ['王奕', 'h2'],\n    ['文文', 'h2'],\n    ['吴燕文', 'h2'],\n    ['谢妮', 'h2'],\n    ['熊沁娴', 'h2'],\n    ['徐晗', 'h2'],\n    ['徐伊人', 'h2'],\n    ['许杨玉琢', 'h2'],\n    ['杨惠婷', 'h2'],\n    ['袁航', 'h2'],\n    ['袁一琦', 'h2'],\n    ['张昕', 'h2'],\n    ['赵梦婷', 'h2'],\n\n    ['陈琳', 'x'],\n    ['冯晓菲', 'x'],\n    ['李晶', 'x'],\n    ['李钊', 'x'],\n    ['林忆宁', 'x'],\n    ['祁静', 'x'],\n    ['邵雪聪', 'x'],\n    ['宋昕冉', 'x'],\n    ['孙歆文', 'x'],\n    ['孙亚萍', 'x'],\n    ['汪佳翎', 'x'],\n    ['汪束', 'x'],\n    ['王晓佳', 'x'],\n    ['谢天依', 'x'],\n    ['杨冰怡', 'x'],\n    ['杨韫玉', 'x'],\n    ['姚祎纯', 'x'],\n    ['张丹三', 'x'],\n    ['张嘉予', 'x'],\n\n    ['陈韫凌', 'x2'],\n    ['费沁源', 'x2'],\n    ['贺苏堃', 'x2'],\n    ['洪珮雲', 'x2'],\n    ['姜杉', 'x2'],\n    ['蒋舒婷', 'x2'],\n    ['李佳恩', 'x2'],\n    ['林歆源', 'x2'],\n    ['刘增艳', 'x2'],\n    ['吕梦莹', 'x2'],\n    ['潘瑛琪', 'x2'],\n    ['宋雨珊', 'x2'],\n    ['陶波尔', 'x2'],\n    ['许嘉怡', 'x2'],\n    ['徐诗琪', 'x2'],\n    ['严佼君', 'x2'],\n    ['於佳怡', 'x2'],\n    ['曾晓雯', 'x2'],\n    ['张文静', 'x2'],\n    ['张怡', 'x2'],\n\n    // Former members\n    ['刘力玮', 'former-s2'],\n    ['申月姣', 'former-s2'],\n    ['赵韩倩', 'former-s2'],\n    ['赵嘉敏', 'former-s2'],\n\n    ['邓艳秋菲', 'former-n2'],\n    ['董艳芸', 'former-n2'],\n    ['罗兰', 'former-n2'],\n    ['孟玥', 'former-n2'],\n    ['钱艺', 'former-n2'],\n    ['唐安琪', 'former-n2'],\n    ['徐真', 'former-n2'],\n    ['张雅梦', 'former-n2'],\n\n    ['陈怡馨', 'former-h2'],\n    ['王璐', 'former-h2'],\n\n    ['闫明筠', 'former-x'],\n    ['张韵雯', 'former-x'],\n\n    ['陈音', 'former-x2'],\n    ['邹佳佳', 'former-x2']\n  ];\n\n  const MEMBER_AFFILIATION_MAP = keyValuePairsToMap(MEMBER_AFFILIATIONS);\n\n  const SEVEN_SENSES_MEMBERS = [\n    '戴萌',\n    '孔肖吟',\n    '许佳琪',\n    '张语格',\n    '赵粤',\n    '许杨玉琢',\n    '陈琳'\n  ];\n\n  const STAGE_AFFILIATIONS = [\n    ['特别公演', ''],\n    ['第48区', 's2'],\n    ['我们向前冲', ''],\n    ['美丽世界', 'h2'],\n    ['代号XⅡ', 'x2'],\n    ['梦想的旗帜', 'x'],\n    ['专属派对', 'n2'],\n    ['心的旅程', 's2']\n  ];\n\n  const STAGE_AFFILIATION_MAP = keyValuePairsToMap(STAGE_AFFILIATIONS);\n\n  const TEAM_DISPLAY_NAMES = {\n    s2: 'SⅡ',\n    n2: 'NⅡ',\n    h2: 'HⅡ',\n    x: 'X',\n    x2: 'XⅡ',\n    'former-s2': '前SⅡ',\n    'former-n2': '前NⅡ',\n    'former-h2': '前HⅡ',\n    'former-x': '前X',\n    'former-x2': '前XⅡ',\n    '7senses': '7SENSES'\n  };\n\n  const prefixByTeam = (str, team) => (team in TEAM_DISPLAY_NAMES)\n        ? `${TEAM_DISPLAY_NAMES[team]} - ${str}`\n        : str;\n\n  const stageBelongsToTeam = (stage, team) => (team === '' || STAGE_AFFILIATION_MAP[stage] === team ||\n                                               (team === '7senses' &&\n                                                (stage === 'special' || stage === '特别公演')));\n\n  const memberInTeam = (member, team) => (team === '' ||\n                                          MEMBER_AFFILIATION_MAP[member] === team ||\n                                          MEMBER_AFFILIATION_MAP[member] === `former-${team}` ||\n                                          (team === '7senses' && SEVEN_SENSES_MEMBERS.indexOf(member) !== -1));\n\n  const getCurrentFilters = () => {\n    const queryParams = URI(window.location).query(true);\n    var filters = {};\n    for (const key of ['year', 'team', 'stage', 'member']) {\n      const vals = queryParams[key];\n      if (vals === undefined) {\n        filters[key] = '';\n      } else if (Array.isArray(vals)) {\n        // Multiple values specified, use the last one.\n        filters[key] = vals[-1];\n      } else {\n        filters[key] = vals;\n      }\n    }\n    return filters;\n  };\n\n  const Filters = React.createClass({\n    getInitialState: function () {\n      return getCurrentFilters();\n    },\n\n    handleChange (event) {\n      const target = event.target;\n      const name = target.name;\n      const value = target.value;\n\n      var updated = {[name]: value};\n      // If the team selection has been updated, make sure to reset the stage\n      // and member selections if they no longer belong to the newly selected\n      // team.\n      if (name === 'team') {\n        if (!stageBelongsToTeam(this.state.stage, value)) {\n          updated.stage = '';\n        }\n        if (!memberInTeam(this.state.member, value)) {\n          updated.member = '';\n        }\n      }\n      this.setState(updated);\n    },\n\n    handleSubmit (event) {\n      const qs = ['year', 'team', 'stage', 'member']\n            .filter((key) => this.state[key] !== '')\n            .map((key) => `${key}=${encodeURIComponent(this.state[key])}`)\n            .join('&');\n      window.location = qs ? `${APPROOT}/?${qs}` : `${APPROOT}/`;\n      event.preventDefault();\n    },\n\n    render: function () {\n      const thisYear = new Date().getFullYear();\n      const yearOptions = [\n        <option value='' key=''>无限制</option>\n      ];\n      for (var year = 2016; year <= thisYear; year++) {\n        yearOptions.push(\n          <option value={year}>{year}</option>\n        );\n      }\n      const selectedYear = this.state.year;\n\n      const teamOptions = [\n        <option value='' key=''>无限制</option>\n      ].concat(\n        ['s2', 'n2', 'h2', 'x', 'x2', '7senses'].map((team) => (\n          <option value={team} key={team}>{TEAM_DISPLAY_NAMES[team]}</option>\n        ))\n      );\n      const selectedTeam = this.state.team;\n\n      const stageOptions = [\n        <option value='' key=''>无限制</option>\n      ].concat(\n        STAGE_AFFILIATIONS\n          .filter(([stage, _]) => stageBelongsToTeam(stage, selectedTeam))\n          .map(([stage, team]) => {\n            // Internal name of the stage, used by the API.\n            const stageInternal = (stage === '特别公演') ? 'special' : stage;\n            return <option value={stageInternal} key={stage}>{prefixByTeam(stage, team)}</option>;\n          })\n      );\n\n      const memberOptions = [\n        <option value='' key=''>无限制</option>\n      ].concat(\n        MEMBER_AFFILIATIONS\n          .filter(([member, _]) => memberInTeam(member, selectedTeam))\n          .map(([member, team]) => (\n            <option value={member} key={member}>{prefixByTeam(member, team)}</option>\n          ))\n      );\n\n      return (\n        <form onSubmit={this.handleSubmit}>\n          <span className='filter'>\n            <label>年份</label>\n            <select name='year' value={this.state.year} onChange={this.handleChange}>\n              {yearOptions}\n            </select>\n          </span>\n          <span className='filter'>\n            <label>队伍</label>\n            <select name='team' value={this.state.team} onChange={this.handleChange}>\n              {teamOptions}\n            </select>\n          </span>\n          <span className='filter'>\n            <label>公演</label>\n            <select name='stage' value={this.state.stage} onChange={this.handleChange}>\n              {stageOptions}\n            </select>\n          </span>\n          <span className='filter'>\n            <label>成员</label>\n            <select name='member' value={this.state.member} onChange={this.handleChange}>\n              {memberOptions}\n            </select>\n          </span>\n          <input type='submit' value='筛选' />\n        </form>\n      );\n    }\n  });\n\n  const PerformanceEntry = React.createClass({\n    render: function () {\n      const entry = this.props.entry;\n      const imgsrc = (entry.video_id !== null)\n            ? `https://i.ytimg.com/vi/${entry.video_id}/mqdefault.jpg`\n            : `${APPROOT}/static/unavailable.jpg`;\n      const youtubeLink = (entry.video_id !== null)\n            ? `https://youtu.be/${entry.video_id}`\n            : null;\n      const titleAbridged = entry.title.replace(/(\\d{8}) SNH48 /, '$1 ');\n      var slug;\n      if (entry.video_id) {\n        slug = entry.video_id;\n      } else if (entry.snh48club_video_id) {\n        slug = `club:${entry.snh48club_video_id}`;\n      }\n\n      var imgElem = <img className='thumbnail' src={imgsrc} alt={titleAbridged} />;\n      if (youtubeLink) {\n        imgElem = <a href={youtubeLink} target='_blank'>{imgElem}</a>;\n      }\n\n      const titleElem = slug\n            ? <span className='title'><a href={`performance/${encodeURIComponent(slug)}`}>{titleAbridged}</a></span>\n            : <span className='title'>{titleAbridged}</span>;\n\n      var performers = [];\n      entry.performers.split(',').slice(0, -1).forEach((performer, index) => {\n        if (index > 0) {\n          // Space-separate names\n          performers.push(' ');\n        }\n        const link = URI.build({\n          path: `${APPROOT}/`,\n          query: URI.buildQuery({member: performer})\n        });\n        performers.push(<a key={performer} href={link}>{performer}</a>);\n      });\n      const performersElem = <span className='performers'>{performers}</span>;\n\n      return <div className='entry'>{imgElem}{titleElem}{performersElem}</div>;\n    }\n  });\n\n  const PerformanceList = React.createClass({\n    filters: getCurrentFilters(),\n    resultsPerPage: 50,\n\n    getInitialState: function () {\n      return {\n        elements: [],\n        total: undefined,\n        page: 0,\n        isInfiniteLoading: false,\n        errored: false\n      };\n    },\n\n    buildElements: function (callback) {\n      if (this.state.total !== undefined &&\n          this.state.total <= this.resultsPerPage * this.state.page) {\n        // Already exhausted all entries\n        callback([]);\n        return;\n      }\n\n      this.state.page++;\n      var queryParams = {\n        page: this.state.page,\n        results_per_page: this.resultsPerPage\n      };\n      for (const key of ['year', 'team', 'stage', 'member']) {\n        if (this.filters[key] !== '') {\n          queryParams[key] = this.filters[key];\n        }\n      }\n      const apiUrl = URI.build({\n        path: `${APPROOT}/api/performance`,\n        query: URI.buildQuery(queryParams)\n      });\n      fetch(apiUrl)\n        .then((response) => {\n          if (response.status !== 200) {\n            this.state.errored = true;\n            return {objects: []};\n          }\n          return response.json();\n        })\n        .then((data) => {\n          if (this.state.total === undefined) {\n            this.state.total = data.num_results;\n          }\n          const elements = data.objects.map((entry) => {\n            var key;\n            if (entry.video_id) {\n              key = entry.video_id;\n            } else if (entry.snh48club_video_id) {\n              key = `club:${entry.snh48club_video_id}`;\n            } else {\n              key = entry.title;\n            }\n            return <PerformanceEntry key={key} entry={entry} />;\n          });\n          callback(elements);\n        });\n    },\n\n    handleInfiniteLoad: function () {\n      this.setState({\n        isInfiniteLoading: true\n      });\n      this.buildElements((elements) => {\n        this.setState({\n          isInfiniteLoading: false,\n          elements: this.state.elements.concat(elements)\n        });\n      });\n    },\n\n    elementInfiniteLoad: function () {\n      return <div className='loading'>加载中...</div>;\n    },\n\n    render: function () {\n      const countElem = (this.state.total !== undefined)\n            ? <div className='count'>共{this.state.total}场</div>\n            : <div className='count' />;\n      const errorElem = this.state.errored\n            ? <div className='error'>获取数据失败。请刷新重试。</div>\n            : null;\n      return (\n        <div>\n          {countElem}\n          <Infinite elementHeight={110}\n            infiniteLoadBeginEdgeOffset={550}\n            onInfiniteLoad={this.handleInfiniteLoad}\n            loadingSpinnerDelegate={this.elementInfiniteLoad()}\n            isInfiniteLoading={this.state.isInfiniteLoading}\n            useWindowAsScrollContainer\n          >\n            {this.state.elements}\n          </Infinite>\n          {errorElem}\n        </div>\n      );\n    }\n  });\n\n  ReactDOM.render(<Filters />, document.getElementById('filters'));\n  ReactDOM.render(<PerformanceList />, document.getElementById('results'));\n})();\n"]}