'use strict';var _slicedToArray=function(){function a(b,c){var d=[],e=!0,f=!1,g=void 0;try{for(var j,h=b[Symbol.iterator]();!(e=(j=h.next()).done)&&(d.push(j.value),!(c&&d.length===c));e=!0);}catch(l){f=!0,g=l}finally{try{!e&&h['return']&&h['return']()}finally{if(f)throw g}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}();function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(){var a=window.APPROOT||'',b=function keyValuePairsToMap(r){return Object.assign.apply(Object,_toConsumableArray(r.map(function(s){var t=_slicedToArray(s,2),u=t[0],w=t[1];return _defineProperty({},u,w)})))},c=[['\u9648\u89C2\u6167','s2'],['\u9648\u601D','s2'],['\u6210\u73CF','s2'],['\u6234\u840C','s2'],['\u848B\u82B8','s2'],['\u5B54\u8096\u541F','s2'],['\u674E\u5B87\u742A','s2'],['\u5415\u4E00','s2'],['\u83AB\u5BD2','s2'],['\u6F58\u71D5\u7426','s2'],['\u94B1\u84D3\u5A77','s2'],['\u90B1\u6B23\u6021','s2'],['\u6C88\u4E4B\u7433','s2'],['\u5B59\u82AE','s2'],['\u6E29\u6676\u5A55','s2'],['\u5434\u54F2\u6657','s2'],['\u5F90\u6668\u8FB0','s2'],['\u5F90\u5B50\u8F69','s2'],['\u8BB8\u4F73\u742A','s2'],['\u8881\u4E39\u59AE','s2'],['\u8881\u96E8\u6862','s2'],['\u5F20\u8BED\u683C','s2'],['\u8D75\u6654','s2'],['\u9648\u4F73\u83B9','n2'],['\u9648\u95EE\u8A00','n2'],['\u51AF\u85AA\u6735','n2'],['\u845B\u4F73\u6167','n2'],['\u9F9A\u8BD7\u6DC7','n2'],['\u4F55\u6653\u7389','n2'],['\u9EC4\u5A77\u5A77','n2'],['\u9EC4\u5F64\u626C','n2'],['\u6C5F\u771F\u4EEA','n2'],['\u91D1\u83B9\u73A5','n2'],['\u97A0\u5A67\u794E','n2'],['\u674E\u827A\u5F64','n2'],['\u6797\u601D\u610F','n2'],['\u5218\u83CA\u5B50','n2'],['\u5218\u701B','n2'],['\u9646\u5A77','n2'],['\u9A6C\u51E1','n2'],['\u4E07\u4E3D\u5A1C','n2'],['\u8BB8\u9038','n2'],['\u6613\u5609\u7231','n2'],['\u66FE\u8273\u82AC','n2'],['\u5F20\u96E8\u946B','n2'],['\u8D75\u7CA4','n2'],['\u5468\u6021','n2'],['\u90ED\u5029\u82B8','h2'],['\u90DD\u5A49\u6674','h2'],['\u59DC\u6DB5','h2'],['\u674E\u6E05\u626C','h2'],['\u6797\u6960','h2'],['\u5218\u7085\u7136','h2'],['\u5218\u4F69\u946B','h2'],['\u6C88\u68A6\u7476','h2'],['\u5B59\u73CD\u59AE','h2'],['\u738B\u67CF\u7855','h2'],['\u738B\u9732\u768E','h2'],['\u738B\u5955','h2'],['\u5434\u71D5\u6587','h2'],['\u8C22\u59AE','h2'],['\u718A\u6C81\u5A34','h2'],['\u5F90\u6657','h2'],['\u5F90\u4F0A\u4EBA','h2'],['\u8BB8\u6768\u7389\u7422','h2'],['\u6768\u60E0\u5A77','h2'],['\u8881\u822A','h2'],['\u8881\u4E00\u7426','h2'],['\u5F20\u6615','h2'],['\u9648\u7433','x'],['\u51AF\u6653\u83F2','x'],['\u674E\u6676','x'],['\u674E\u948A','x'],['\u6797\u5FC6\u5B81','x'],['\u7941\u9759','x'],['\u90B5\u96EA\u806A','x'],['\u5B8B\u6615\u5189','x'],['\u5B59\u6B46\u6587','x'],['\u5B59\u4E9A\u840D','x'],['\u6C6A\u4F73\u7FCE','x'],['\u6C6A\u675F','x'],['\u738B\u6653\u4F73','x'],['\u8C22\u5929\u4F9D','x'],['\u6768\u51B0\u6021','x'],['\u6768\u97EB\u7389','x'],['\u59DA\u794E\u7EAF','x'],['\u5F20\u4E39\u4E09','x'],['\u5F20\u5609\u4E88','x'],['\u9648\u97EB\u51CC','x2'],['\u8D39\u6C81\u6E90','x2'],['\u6D2A\u73EE\u96F2','x2'],['\u59DC\u6749','x2'],['\u848B\u8212\u5A77','x2'],['\u674E\u4F73\u6069','x2'],['\u6797\u6B46\u6E90','x2'],['\u5218\u589E\u8273','x2'],['\u5415\u68A6\u83B9','x2'],['\u6F58\u745B\u742A','x2'],['\u5B8B\u96E8\u73CA','x2'],['\u9676\u6CE2\u5C14','x2'],['\u8BB8\u5609\u6021','x2'],['\u5F90\u8BD7\u742A','x2'],['\u4E25\u4F7C\u541B','x2'],['\u65BC\u4F73\u6021','x2'],['\u66FE\u6653\u96EF','x2'],['\u5F20\u6587\u9759','x2'],['\u5F20\u6021','x2'],['\u5218\u529B\u73AE','former-s2'],['\u7533\u6708\u59E3','former-s2'],['\u8D75\u97E9\u5029','former-s2'],['\u8D75\u5609\u654F','former-s2'],['\u9093\u8273\u79CB\u83F2','former-n2'],['\u8463\u8273\u82B8','former-n2'],['\u7F57\u5170','former-n2'],['\u5B5F\u73A5','former-n2'],['\u94B1\u827A','former-n2'],['\u5510\u5B89\u742A','former-n2'],['\u5F90\u771F','former-n2'],['\u5F20\u96C5\u68A6','former-n2'],['\u9648\u6021\u99A8','former-h2'],['\u738B\u91D1\u94ED','former-h2'],['\u738B\u7490','former-h2'],['\u6587\u6587','former-h2'],['\u8D75\u68A6\u5A77','former-h2'],['\u95EB\u660E\u7B60','former-x'],['\u5F20\u97F5\u96EF','former-x'],['\u9648\u97F3','former-x2'],['\u8D3A\u82CF\u5803','former-x2'],['\u90B9\u4F73\u4F73','former-x2']],d=b(c),e=['\u6234\u840C','\u5B54\u8096\u541F','\u8BB8\u4F73\u742A','\u5F20\u8BED\u683C','\u8D75\u7CA4','\u8BB8\u6768\u7389\u7422','\u9648\u7433'],f=[['\u7279\u522B\u516C\u6F14',''],['\u4EE5\u7231\u4E4B\u540D','n2'],['\u7B2C48\u533A','s2'],['\u6211\u4EEC\u5411\u524D\u51B2',''],['\u7F8E\u4E3D\u4E16\u754C','h2'],['\u4EE3\u53F7X\u2161','x2'],['\u68A6\u60F3\u7684\u65D7\u5E1C','x'],['\u4E13\u5C5E\u6D3E\u5BF9','n2'],['\u5FC3\u7684\u65C5\u7A0B','s2']],g=b(f),h={s2:'S\u2161',n2:'N\u2161',h2:'H\u2161',x:'X',x2:'X\u2161','former-s2':'\u524DS\u2161','former-n2':'\u524DN\u2161','former-h2':'\u524DH\u2161','former-x':'\u524DX','former-x2':'\u524DX\u2161','7senses':'7SENSES'},j=function prefixByTeam(r,s){return s in h?h[s]+' - '+r:r},l=function stageBelongsToTeam(r,s){return''===s||g[r]===s||'7senses'===s&&('special'===r||'\u7279\u522B\u516C\u6F14'===r)},m=function memberInTeam(r,s){return''===s||d[r]===s||d[r]==='former-'+s||'7senses'===s&&-1!==e.indexOf(r)},n=function getCurrentFilters(){for(var r=URI(window.location).query(!0),s={},t=['year','team','stage','member'],u=0;u<t.length;u++){var w=t[u],x=r[w];s[w]=void 0===x?'':Array.isArray(x)?x[-1]:x}return s},o=React.createClass({displayName:'Filters',getInitialState:function getInitialState(){return n()},handleChange:function handleChange(r){var s=r.target,t=s.name,u=s.value,w=_defineProperty({},t,u);'team'===t&&(!l(this.state.stage,u)&&(w.stage=''),!m(this.state.member,u)&&(w.member='')),this.setState(w)},handleSubmit:function handleSubmit(r){var s=this,t=['year','team','stage','member'].filter(function(u){return''!==s.state[u]}).map(function(u){return u+'='+encodeURIComponent(s.state[u])}).join('&');window.location=t?a+'/?'+t:a+'/',r.preventDefault()},render:function render(){for(var r=new Date().getFullYear(),s=[React.createElement('option',{value:'',key:''},'\u65E0\u9650\u5236')],t=2016;t<=r;t++)s.push(React.createElement('option',{value:t},t));var u=this.state.year,w=[React.createElement('option',{value:'',key:''},'\u65E0\u9650\u5236')].concat(['s2','n2','h2','x','x2','7senses'].map(function(C){return React.createElement('option',{value:C,key:C},h[C])})),x=this.state.team,y=[React.createElement('option',{value:'',key:''},'\u65E0\u9650\u5236')].concat(f.filter(function(C){var D=_slicedToArray(C,2),E=D[0],F=D[1];return l(E,x)}).map(function(C){var D=_slicedToArray(C,2),E=D[0],F=D[1],G='\u7279\u522B\u516C\u6F14'===E?'special':E;return React.createElement('option',{value:G,key:E},j(E,F))})),z=[React.createElement('option',{value:'',key:''},'\u65E0\u9650\u5236')],A=[],B=null;return c.filter(function(C){var D=_slicedToArray(C,2),E=D[0],F=D[1];return m(E,x)}).forEach(function(C){var D=_slicedToArray(C,2),E=D[0],F=D[1];F!==B&&(0<A.length&&z.push(React.createElement('optgroup',{label:h[B]},A)),A=[],B=F),A.push(React.createElement('option',{value:E,key:E},j(E,F)))}),0<A.length&&z.push(React.createElement('optgroup',{label:h[B]},A)),React.createElement('form',{onSubmit:this.handleSubmit},React.createElement('span',{className:'filter'},React.createElement('label',null,'\u5E74\u4EFD'),React.createElement('select',{name:'year',value:this.state.year,onChange:this.handleChange},s)),React.createElement('span',{className:'filter'},React.createElement('label',null,'\u961F\u4F0D'),React.createElement('select',{name:'team',value:this.state.team,onChange:this.handleChange},w)),React.createElement('span',{className:'filter'},React.createElement('label',null,'\u516C\u6F14'),React.createElement('select',{name:'stage',value:this.state.stage,onChange:this.handleChange},y)),React.createElement('span',{className:'filter'},React.createElement('label',null,'\u6210\u5458'),React.createElement('select',{name:'member',value:this.state.member,onChange:this.handleChange},z)),React.createElement('input',{type:'submit',value:'\u7B5B\u9009'}))}}),p=React.createClass({displayName:'PerformanceEntry',render:function render(){var r=this.props.entry,s=null===r.video_id?a+'/static/unavailable.jpg':'https://i.ytimg.com/vi/'+r.video_id+'/mqdefault.jpg',t=null===r.video_id?null:'https://youtu.be/'+r.video_id,u=r.title.replace(/(\d{8}) SNH48 /,'$1 '),w;r.video_id?w=r.video_id:r.snh48club_video_id&&(w='club:'+r.snh48club_video_id);var x=React.createElement('img',{className:'thumbnail',src:s,alt:u});t&&(x=React.createElement('a',{href:t,target:'_blank'},x));var y=w?React.createElement('span',{className:'title'},React.createElement('a',{href:'performance/'+encodeURIComponent(w)},u)):React.createElement('span',{className:'title'},u),z=[];r.performers.split(',').slice(0,-1).forEach(function(B,C){0<C&&z.push(' ');var D=URI.build({path:a+'/',query:URI.buildQuery({member:B})});z.push(React.createElement('a',{key:B,href:D},B))});var A=React.createElement('span',{className:'performers'},z);return React.createElement('div',{className:'entry'},x,y,A)}}),q=React.createClass({displayName:'PerformanceList',filters:n(),resultsPerPage:50,getInitialState:function getInitialState(){return{elements:[],total:void 0,page:0,isInfiniteLoading:!1,errored:!1}},buildElements:function buildElements(r){var s=this;if(void 0!==this.state.total&&this.state.total<=this.resultsPerPage*this.state.page)return void r([]);this.state.page++;for(var y,t={page:this.state.page,results_per_page:this.resultsPerPage},u=['year','team','stage','member'],w=0;w<u.length;w++)y=u[w],''!==this.filters[y]&&(t[y]=this.filters[y]);var x=URI.build({path:a+'/api/performance',query:URI.buildQuery(t)});fetch(x).then(function(y){return 200===y.status?y.json():(s.state.errored=!0,{objects:[]})}).then(function(y){s.state.total===void 0&&(s.state.total=y.num_results);var z=y.objects.map(function(A){var B;return B=A.video_id?A.video_id:A.snh48club_video_id?'club:'+A.snh48club_video_id:A.title,React.createElement(p,{key:B,entry:A})});r(z)})},handleInfiniteLoad:function handleInfiniteLoad(){var r=this;this.setState({isInfiniteLoading:!0}),this.buildElements(function(s){r.setState({isInfiniteLoading:!1,elements:r.state.elements.concat(s)})})},elementInfiniteLoad:function elementInfiniteLoad(){return React.createElement('div',{className:'loading'},'\u52A0\u8F7D\u4E2D...')},render:function render(){var r=this.state.total===void 0?React.createElement('div',{className:'count'}):React.createElement('div',{className:'count'},'\u5171',this.state.total,'\u573A'),s=this.state.errored?React.createElement('div',{className:'error'},'\u83B7\u53D6\u6570\u636E\u5931\u8D25\u3002\u8BF7\u5237\u65B0\u91CD\u8BD5\u3002'):null;return React.createElement('div',null,r,React.createElement(Infinite,{elementHeight:110,infiniteLoadBeginEdgeOffset:550,onInfiniteLoad:this.handleInfiniteLoad,loadingSpinnerDelegate:this.elementInfiniteLoad(),isInfiniteLoading:this.state.isInfiniteLoading,useWindowAsScrollContainer:!0},this.state.elements),s)}});ReactDOM.render(React.createElement(o,null),document.getElementById('filters')),ReactDOM.render(React.createElement(q,null),document.getElementById('results'))})();

//# sourceMappingURL=ui.min.js.map